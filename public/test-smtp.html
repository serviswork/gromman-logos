<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–¢–µ—Å—Ç SMTP - Gromman Concierge</title>
  <style>
    body {
      font-family: 'Inter', sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .test-section {
      margin: 20px 0;
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 8px;
    }
    .success { background: #d4edda; border-color: #c3e6cb; }
    .error { background: #f8d7da; border-color: #f5c6cb; }
    .info { background: #d1ecf1; border-color: #bee5eb; }
    .warning { background: #fff3cd; border-color: #ffeaa7; }
    
    button {
      background: #007bff;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      margin: 5px;
    }
    button:hover { background: #0056b3; }
    button:disabled { background: #6c757d; cursor: not-allowed; }
    
    .form-group {
      margin: 15px 0;
    }
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
    input, select, textarea {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      box-sizing: border-box;
    }
    textarea {
      height: 100px;
      resize: vertical;
    }
    
    .log {
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 4px;
      padding: 15px;
      margin: 10px 0;
      font-family: monospace;
      font-size: 12px;
      max-height: 300px;
      overflow-y: auto;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üß™ –¢–µ—Å—Ç SMTP –æ—Ç–ø—Ä–∞–≤–∫–∏ - Gromman Concierge</h1>
    
    <div class="test-section info">
      <h3>üìã –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏</h3>
      <p><strong>–¶–µ–ª—å:</strong> –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–∏—Å–µ–º —á–µ—Ä–µ–∑ SMTP Zoho</p>
      <p><strong>SMTP –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:</strong></p>
      <ul>
        <li>–•–æ—Å—Ç: smtp.zoho.com</li>
        <li>–ü–æ—Ä—Ç: 587</li>
        <li>–ü—Ä–æ—Ç–æ–∫–æ–ª: STARTTLS</li>
        <li>–û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å: info@gromman.com</li>
        <li>–ü–æ–ª—É—á–∞—Ç–µ–ª—å: info@gromman.com</li>
      </ul>
    </div>

    <div class="test-section">
      <h3>üîß –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏</h3>
      <button onclick="checkConfig()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å .env —Ñ–∞–π–ª</button>
      <button onclick="testSMTPConnection()">–¢–µ—Å—Ç SMTP –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</button>
      <div id="config-result" class="log"></div>
    </div>

    <div class="test-section">
      <h3>üìß –¢–µ—Å—Ç–æ–≤–∞—è —Ñ–æ—Ä–º–∞</h3>
      <form id="test-form">
        <div class="form-group">
          <label for="test-name">–ò–º—è:</label>
          <input type="text" id="test-name" value="–¢–µ—Å—Ç–æ–≤—ã–π –∫–∞–Ω–¥–∏–¥–∞—Ç" required>
        </div>
        
        <div class="form-group">
          <label for="test-email">Email:</label>
          <input type="email" id="test-email" value="test@example.com" required>
        </div>
        
        <div class="form-group">
          <label for="test-telegram">Telegram:</label>
          <input type="text" id="test-telegram" value="@test_user">
        </div>
        
        <div class="form-group">
          <label for="test-role">–í–∞–∫–∞–Ω—Å–∏—è:</label>
          <select id="test-role" required>
            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞–∫–∞–Ω—Å–∏—é</option>
            <option value="–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–∏—Ä–µ–∫—Ç–æ—Ä (CTO)" selected>–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–∏—Ä–µ–∫—Ç–æ—Ä (CTO)</option>
            <option value="–ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä XAI">–ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä XAI</option>
            <option value="Fullstack-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ (FastAPI, Frontend)">Fullstack-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ (FastAPI, Frontend)</option>
            <option value="Rasa Pro –∏–Ω–∂–µ–Ω–µ—Ä (CALM, LLM, Flow)">Rasa Pro –∏–Ω–∂–µ–Ω–µ—Ä (CALM, LLM, Flow)</option>
            <option value="ML-–∏–Ω–∂–µ–Ω–µ—Ä / Vision / Audio AI">ML-–∏–Ω–∂–µ–Ω–µ—Ä / Vision / Audio AI</option>
            <option value="UI/UX-–¥–∏–∑–∞–π–Ω–µ—Ä (–≤–µ–±/–º–æ–±)">UI/UX-–¥–∏–∑–∞–π–Ω–µ—Ä (–≤–µ–±/–º–æ–±)</option>
            <option value="–ö–æ–Ω—Ç–µ–Ω—Ç-–º–µ–π–∫–µ—Ä / –ú–∞—Ä–∫–µ—Ç–æ–ª–æ–≥ / TikTok">–ö–æ–Ω—Ç–µ–Ω—Ç-–º–µ–π–∫–µ—Ä / –ú–∞—Ä–∫–µ—Ç–æ–ª–æ–≥ / TikTok</option>
            <option value="–ú–µ–Ω–µ–¥–∂–µ—Ä –ø–æ –ø—Ä–æ–¥—É–∫—Ç—É (Product/Project)">–ú–µ–Ω–µ–¥–∂–µ—Ä –ø–æ –ø—Ä–æ–¥—É–∫—Ç—É (Product/Project)</option>
            <option value="–Æ—Ä–∏—Å—Ç / –î–æ–∫—É–º–µ–Ω—Ç–æ–æ–±–æ—Ä–æ—Ç">–Æ—Ä–∏—Å—Ç / –î–æ–∫—É–º–µ–Ω—Ç–æ–æ–±–æ—Ä–æ—Ç</option>
            <option value="–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä –ø–æ –ø–∞—Ä—Ç–Ω—ë—Ä–∞–º / –ø—Ä–æ–¥–∞–∂–∞–º / CRM">–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä –ø–æ –ø–∞—Ä—Ç–Ω—ë—Ä–∞–º / –ø—Ä–æ–¥–∞–∂–∞–º / CRM</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="test-message">–°–æ–æ–±—â–µ–Ω–∏–µ:</label>
          <textarea id="test-message" required>–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ SMTP –æ—Ç–ø—Ä–∞–≤–∫–∏. 

–Ø —Ö–æ—á—É –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –∫–æ–º–∞–Ω–¥–µ Gromman Concierge –∏ –≤–Ω–µ—Å—Ç–∏ —Å–≤–æ–π –≤–∫–ª–∞–¥ –≤ —Ä–∞–∑–≤–∏—Ç–∏–µ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ AI –¥–ª—è –æ—Ç–µ–ª–µ–π.

–í—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏: ${new Date().toLocaleString()}</textarea>
        </div>
        
        <button type="button" onclick="sendTestEmail()">üìß –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ –ø–∏—Å—å–º–æ</button>
        <button type="button" onclick="clearLogs()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏</button>
      </form>
      
      <div id="test-result" class="log"></div>
    </div>

    <div class="test-section warning">
      <h3>‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è</h3>
      <ul>
        <li>–î–ª—è —Ä–∞–±–æ—Ç—ã SMTP –Ω—É–∂–µ–Ω Node.js —Å–µ—Ä–≤–µ—Ä (server.js)</li>
        <li>–§–∞–π–ª .env –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ SMTP –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</li>
        <li>App Password –∏–∑ Zoho –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–º</li>
        <li>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∞–ø–∫—É Spam –≤ –ø–æ—á—Ç–µ info@gromman.com</li>
      </ul>
    </div>

    <div class="test-section">
      <h3>üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∑–∞–ø—É—Å–∫—É</h3>
      <ol>
        <li>–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Node.js: <code>brew install node</code> (macOS)</li>
        <li>–°–æ–∑–¥–∞–π—Ç–µ .env: <code>cp env.example .env</code></li>
        <li>–ù–∞—Å—Ç—Ä–æ–π—Ç–µ SMTP_PASSWORD –≤ .env</li>
        <li>–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: <code>npm install</code></li>
        <li>–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä: <code>npm run dev</code></li>
        <li>–û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:3000/test-smtp.html</li>
      </ol>
    </div>
  </div>

  <script>
    function log(message, type = 'info') {
      const logDiv = document.getElementById('test-result');
      const timestamp = new Date().toLocaleTimeString();
      const logEntry = `[${timestamp}] ${message}\n`;
      logDiv.textContent += logEntry;
      logDiv.scrollTop = logDiv.scrollHeight;
    }

    function clearLogs() {
      document.getElementById('test-result').textContent = '';
      document.getElementById('config-result').textContent = '';
    }

    function checkConfig() {
      log('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏...');
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ .env —Ñ–∞–π–ª–∞
      fetch('/api/health')
        .then(response => response.json())
        .then(data => {
          if (data.status === 'OK') {
            log('‚úÖ –°–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç', 'success');
            log(`üìä Environment: ${data.environment}`);
            log(`‚è∞ Timestamp: ${data.timestamp}`);
          } else {
            log('‚ùå –°–µ—Ä–≤–µ—Ä –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç', 'error');
          }
        })
        .catch(error => {
          log('‚ùå –°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω: ' + error.message, 'error');
          log('üí° –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ server.js –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 3000');
        });
    }

    function testSMTPConnection() {
      log('üîå –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ SMTP –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è...');
      
      // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
      const testData = {
        name: 'SMTP Test',
        email: 'test@gromman.com',
        telegram: '@smtp_test',
        role: '–¢–µ—Å—Ç–æ–≤–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ',
        message: '–ü—Ä–æ–≤–µ—Ä–∫–∞ SMTP —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è',
        source: 'test_smtp_connection',
        language: 'ru'
      };

      fetch('/api/submit-form', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(testData)
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          log('‚úÖ SMTP –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ!', 'success');
          log(`üìß Message ID: ${data.messageId}`);
          log('üì¨ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—á—Ç—É info@gromman.com');
        } else {
          log('‚ùå –û—à–∏–±–∫–∞ SMTP: ' + (data.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'), 'error');
          if (data.errors) {
            data.errors.forEach(error => log('   - ' + error, 'error'));
          }
        }
      })
      .catch(error => {
        log('‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ' + error.message, 'error');
        log('üí° –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:');
        log('   1. –ó–∞–ø—É—â–µ–Ω –ª–∏ server.js');
        log('   2. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ª–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ .env');
        log('   3. –í–∞–ª–∏–¥–Ω—ã–π –ª–∏ App Password');
      });
    }

    function sendTestEmail() {
      const formData = {
        name: document.getElementById('test-name').value,
        email: document.getElementById('test-email').value,
        telegram: document.getElementById('test-telegram').value,
        role: document.getElementById('test-role').value,
        message: document.getElementById('test-message').value,
        source: 'test_form',
        language: 'ru'
      };

      log('üìß –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–∏—Å—å–º–∞...');
      log(`üë§ –û—Ç: ${formData.name} (${formData.email})`);
      log(`üíº –í–∞–∫–∞–Ω—Å–∏—è: ${formData.role}`);

      fetch('/api/submit-form', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(formData)
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          log('‚úÖ –ü–∏—Å—å–º–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ!', 'success');
          log(`üìß Message ID: ${data.messageId}`);
          log('üì¨ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—á—Ç—É info@gromman.com');
          log('üîç –ù–µ –∑–∞–±—É–¥—å—Ç–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞–ø–∫—É Spam');
        } else {
          log('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: ' + (data.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'), 'error');
          if (data.errors) {
            data.errors.forEach(error => log('   - ' + error, 'error'));
          }
        }
      })
      .catch(error => {
        log('‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + error.message, 'error');
        log('üí° –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –∏ –¥–æ—Å—Ç—É–ø–µ–Ω');
      });
    }

    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    window.onload = function() {
      log('üöÄ –¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
      log('üìã –ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é SMTP –æ—Ç–ø—Ä–∞–≤–∫–∏');
      log('üí° –ù–∞–∂–º–∏—Ç–µ "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å .env —Ñ–∞–π–ª" –¥–ª—è –Ω–∞—á–∞–ª–∞');
    };
  </script>
</body>
</html> 